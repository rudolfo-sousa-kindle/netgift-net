{"ast":null,"code":"var ejs = require('ejs');\n\nvar fs = require('fs');\n\nvar compiled = [];\n\nvar render = function (template, data, cb) {\n  var error = null;\n  data = data || {};\n\n  try {\n    var output = compiled[template](data);\n  } catch (err) {\n    output = '<h1>Internal server error</h1><code>' + err + '</code>';\n    error = err;\n  }\n\n  if (typeof cb === 'function') {\n    return cb(error, output);\n  }\n\n  if (error) {\n    this.statusCode = 500;\n    this.setHeader('Content-Type', 'text/html');\n  }\n\n  this.end(output);\n};\n\nmodule.exports = function (dir) {\n  if (!dir) throw new Error('no template directory defined');\n  var templates = fs.readdirSync(dir);\n  templates.forEach(function (t) {\n    var html = fs.readFileSync(dir + '/' + t).toString();\n    compiled[t] = ejs.compile(html);\n  });\n  return function (req, res, next) {\n    res.render = render;\n    next();\n  };\n};","map":null,"metadata":{},"sourceType":"script"}